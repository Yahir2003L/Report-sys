---
  import '../styles/global.css'
  import Header from '../components/Header.astro'
  import Footer from '../components/Footer.astro'
  import CreateUserModal from '@/components/CreateUserModal.astro'
  import { isSuperadmin } from '../lib/access-control';
  import CreateReportModal from '@/components/CreateReportModal.astro';
  import Logout from '@/components/icons/Logout.astro';
  import Bachillerato from '@/components/icons/Bachillerato.astro';
  import Home from '@/components/icons/Home.astro';
  import Primaria from '@/components/icons/Primaria.astro';
  import Secundaria from '@/components/icons/Secundaria.astro';
  import Universidad from '@/components/icons/Universidad.astro';
  import Users from '@/components/icons/Users.astro';
 
interface Props {
  user: {
    userId: number;
    username: string;
    fullName: string;
    role: 'superadmin' | 'admin' | 'user';
    sector: 'primaria' | 'secundaria' | 'bachillerato' | 'universidad';
  } | null | undefined;
  token?: string;
  title?: string;
  currentSector?: 'primaria' | 'secundaria' | 'bachillerato' | 'universidad';
}

const { user, token, title, currentSector: propSector } = Astro.props;
const isSuperAdmin = user ? isSuperadmin(user) : false;
const currentSector = propSector || user?.sector || 'secundaria';

 if ( !Astro.props.user && Astro.url.pathname !== '/login' ) {
   return Astro.redirect('/login');
 }
---


<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="generator" content={Astro.generator} />
    <title>{title ?? 'Sistema de Reportes'}</title>
    <script  is:inline src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body data-user-role={user?.role} class="flex">
    <div class="flex justify-between flex-col px-3 py-5 shadow-md w-1/4 h-screen">
      <div class="flex flex-col gap-y-10">
        <a>LOGO</a>
        <div class="flex flex-col gap-y-5">
          <a href="" class="flex gap-x-3"><Home/>Inicio</a>
          <a href="" class="flex gap-x-3"><Primaria/>Primaria</a>
          <a href="" class="flex gap-x-3"><Secundaria/>Secundaria</a>
          <a href="" class="flex gap-x-3"><Bachillerato/>Bachillerato</a>
          <a href="" class="flex gap-x-3"><Universidad/>Universidad</a>
          <a href="" class="flex gap-x-3"><Users/>Usuarios</a>
        </div>
      </div>
      <div>
        <div>
          <form method="POST" action="/api/logout">
            <input type="hidden" name="token" value={Astro.cookies.get('session_token')?.value} />
            <button type="submit" class="flex items-center gap-x-2 cursor-pointer">
              <Logout class="w-5"/>
              Cerrar sesi√≥n
            </button>
          </form>
          <a href="">
            <span>{user?.fullName}</span>
            <span>{user?.role} - {user?.sector}</span>
          </a>
        </div>
      </div>
    </div>

    <slot />
    <Footer />
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
</style>